function ProductSelected(n,t){var f=$("#zssbpp-"+n),r=f.find(".zssbpp-product-container"),u=$("#account-number-container"),i;u.length>0&&u.detach();r.find("div.input-group").not(".zssbpp-product-selector").remove();i=FindProduct(t);i.PrePurchaseInstructions&&i.PrePurchaseInstructions.length>0&&r.prepend(i.PrePurchaseInstructions);r.append(CreateInputGroup(n,i,u));r.find(".billaccount").parent(".input-group").after(u);$(".billaccount").val()&&$(".billaccount").trigger("change");f.find("#cmdProceed").text(i.GoButtonText)}function FindProduct(n){var t=null;if($.each(zssBillPaymentProviders,function(){if(t)return!1;var i=this;$.each(i.Products,function(){var i=this;if(i.Id==n)return t=i,!1})}),!t)throw new Error("Product not found");return t}function CreateInputGroup(n,t,i){var r="",e="zssbpp-account-"+n,f="zssbpp-amount-"+n,u=Cookies.get("zssbpp-account-"+t.CssCookieIdentifier).split("#"),o=Cookies.get(f);return u=u.length==0?"":decodeURI(u[0].split(":")[0]),account&&(u=account),amount&&(o=amount),r+="<div class='form-group zssAccountDiv'><label for='"+e+"'>"+t.AccountLabel+"<\/label>",i.length>0&&(r+="<div class='input-group'>"),r+="<input type='text' class='form-control billaccount "+t.CssCookieIdentifier+"' id='"+e+"' name='account' value='"+u+"' required "+(t.AccountFieldValidationRegex&&t.AccountFieldValidationRegex.length>0?"pattern='"+t.AccountFieldValidationRegex+"'":"")+" />",i.length>0&&(r+="<span title='Choose from your list of applicable accounts' class='input-group-addon autofill-button' data-toggle='collapse' data-parent='form' data-target='#account-number-container'><\/span><\/div>"),r+=(t.AccountDescription?"<small class='subtext'>"+t.AccountDescription+"<\/small>":"")+"<\/div>",t.AuthProviderReturnsAccountBalance||(r+="<div class='form-group'><label for='"+f+"'>"+t.AmountLabel+"<\/label><div class='input-group'><div class='input-group-addon'>ZWL<\/div> <input class='form-control' type='number' step='0.01' min='"+t.MinAmount+"' max='"+t.MaxAmount+"' id='"+f+"' name='amount' required value='"+o+"' /><\/div>"+(t.AmountDescription?"<small class='subtext'>"+t.AmountDescription+"<\/small>":"")+(window.forex?"<div id='forex-conversion' class='small' style='display:none'>This amounts to <span class='label label-danger'>"+window.currencyCode+" <span id='forex-price'>0.00<\/span><\/span><\/div>":"")+"<\/div><\/div>"),r+="<input type='hidden' name='suffix' value='"+n+"' />",r+="<div class='clear'><\/div>","<div class='recharge-details recharge-details-1"+(t.OneOfMany?"-2":"")+"'>"+r+"<\/div>"}function ZssBppSubmit(n){if(zssBppSubmitted)return!1;var i=$("#zssbpp-"+n),s=i.find("#cmdProceed"),h=i.find(".cancel-button, .expresscheckout"),f=i.find("input[name=email]"),e=i.find("input[name=mobile]"),u=i.find("input[name=amount]"),r="",t=null,o=0;return(u.length>0&&(o=parseFloat(u.val())),u.length>0&&isNaN(o)&&(r+="You must enter an amount for this payment\n",t=u),f.val().length==0||/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(f.val())||(r+="You must enter a valid e-mail address where your payment details will be sent\n",t||(t=f)),mobile.val().length!=0&&/^(\+\d{1,3}|0)?(\d{9})$/.test(e.val())||(r+="Enter a valid mobile number where your payment details will be sent\n",t||(t=e)),r.length>0)?(alert(r),t&&t.focus(),!1):(zssBppSubmitted=!0,s.prop("disabled",!0).text("Please wait..."),h.hide(),!0)}var zssBppSubmitted=!1,ZETDC;$(function(){$("select.zssbpp-product").change(function(){ProductSelected($(this).attr("data-suffix"),$(this).find("option:selected").val())}).each(function(){var n=$(this),t=n.find("option").length;this.selectedIndex=-1;t===1&&(this.selectedIndex=0,n.parent(".zssbpp-product-selector").hide(),n.trigger("change"))});window.forex&&setInterval(function(){var n=parseFloat($("input[name=amount]").val());isNaN(n)?($("#forex-price").text("0.00"),$("#forex-conversion").hide()):($("#forex-price").text((Math.ceil(n*100/window.currencyRate)/100).toFixed(2)),$("#forex-conversion").show())},500)});ZETDC={t1:.49,t2:1.08,t3:4.61,timeout:null,container:null,unitContainer:null,tokenInfoContainer:null,meterNumber:"",meterInfo:null,init:function(){$(document).on("keyup change",".billaccount",function(n){(n.keyCode||n.which)!="9"&&ZETDC.meterNumber!=n.target.value&&(ZETDC.timeout&&clearTimeout(ZETDC.timeout),ZETDC.meterNumber=n.target.value,/^\d+$/.test(ZETDC.meterNumber)||(ZETDC.meterNumber=null),ZETDC.meterNumber?ZETDC.timeout=setTimeout(function(){ZETDC.getMeterInfo()},1e3):(ZETDC.meterInfo=null,ZETDC.container&&ZETDC.container.hide(),ZETDC.tokenInfoContainer&&ZETDC.tokenInfoContainer.hide()))});$(document).on("keyup change","input[id^=zssbpp-amount-zss-zesa-pre-paid]",function(n){(n.keyCode||n.which)!="9"&&ZETDC.meterInfo&&ZETDC.displayUnits()});$(document).on("keyup change","#zetdc-units",function(n){(n.keyCode||n.which)!="9"&&ZETDC.meterInfo&&ZETDC.displayAmount()})},displayUnits:function(){var n=parseFloat($("input[id^=zssbpp-amount-zss-zesa-pre-paid]").val()),t;ZETDC.prepContainer();ZETDC.meterInfo?isNaN(n)?ZETDC.container.text("Enter the amount you want to spend or the number of units you'd like to purchase above").show():(t=ZETDC.computeUnits(n),$("#zetdc-units").val(t),ZETDC.container.text("Your $"+n.toFixed(2)+" purchase will amount to approximately "+t+" units").show()):ZETDC.container.hide()},displayAmount:function(){var n=parseFloat($("#zetdc-units").val()),t;ZETDC.prepContainer();ZETDC.meterInfo?isNaN(n)?ZETDC.container.text("Enter the amount you want to spend or the number of units you'd like to purchase above").show():(t=ZETDC.computeAmount(n),$("input[id^=zssbpp-amount-zss-zesa-pre-paid]").val(t),ZETDC.container.text("Your "+n+" units will cost approximately $"+t).show()):ZETDC.container.hide()},getMeterInfo:function(){ZETDC.prepContainer();ZETDC.container.html("Getting details for meter number "+ZETDC.meterNumber+"... <img src='/content/loader_grey.gif' />").show();ZETDC.tokenInfoContainer.hide();$.post("/pay/zetdcmeterinfo/"+ZETDC.meterNumber,"json").done(function(n){n?($("#zetdc-units-container").show(),ZETDC.meterInfo=n,ZETDC.tokenInfoContainer.find("*").not("a").remove(),ZETDC.tokenInfoContainer.show(),$("#zetdc-tokeninfo-container a").show(),$("input[id^=zssbpp-amount-zss-zesa-pre-paid]").val()?ZETDC.displayUnits():ZETDC.displayAmount()):($("#zetdc-units-container").hide(),ZETDC.container.hide(),ZETDC.tokenInfoContainer.hide())}).fail(function(){$("#zetdc-units-container").hide();ZETDC.container.hide();ZETDC.tokenInfoContainer.hide();ZETDC.meterInfo=null})},computeAmount:function(n){var i=0,r=0,t;switch(ZETDC.meterInfo.cod_TAR){case"170":case"171":case"181":case"182":case"183":case"184":case"185":case"186":case"187":for(t=ZETDC.meterInfo.total_UNITS+1;t<=ZETDC.meterInfo.total_UNITS+Number(n);t++)t>0&&t<=50?i+=ZETDC.t1:t>50&&t<=200?i+=ZETDC.t2:t>200&&(i+=ZETDC.t3);r=(Number(i.toFixed(2))+Number(.06*i.toFixed(2))).toFixed(2);break;case"177":r=(1.1011*Number(n)).toFixed(2);break;case"173":case"174":case"175":case"176":r=(2*Number(n)+2*Number(n)*.21).toFixed(2)}return r},computeUnits:function(n){var t=n-.06*n,r,u,i=0,f,e;switch(ZETDC.meterInfo.cod_TAR){case"170":case"171":case"181":case"182":case"183":case"184":case"185":case"186":case"187":ZETDC.meterInfo.total_UNITS>=0&&ZETDC.meterInfo.total_UNITS<=50?(r=ZETDC.t1*(50-ZETDC.meterInfo.total_UNITS),t<r?i=(t/ZETDC.t1).toFixed(2):(f=50-ZETDC.meterInfo.total_UNITS,(u=t-r)<136.5?i=(u/ZETDC.t2+f).toFixed(2):(e=(u-136.5)/ZETDC.t3,i=(e+200).toFixed(2)))):ZETDC.meterInfo.total_UNITS>50&&ZETDC.meterInfo.total_UNITS<=200?(r=200-ZETDC.meterInfo.total_UNITS)<=150?ZETDC.t2*r>t?i=(t/ZETDC.t2).toFixed(2):(u=t-ZETDC.t2*r,i=(u/ZETDC.t3+r).toFixed(2)):(u=t-(ZETDC.t2*r).toFixed(2),i=(u/ZETDC.t3+r).toFixed(2)):ZETDC.meterInfo.total_UNITS>200&&(i=(t/ZETDC.t3).toFixed(2));break;case"177":t+=.06*n;t-=.21*t;i=(n/1.1011).toFixed(2);break;case"173":case"174":case"175":case"176":t-=.15*t;i=(n/2.42).toFixed(2)}return i},getPurchaseHistory:function(){$.post("/pay/zetdctokeninfo/"+ZETDC.meterNumber,"json").done(function(n){var i,t;if($("#zetdc-tokeninfo-container a").hide(),n&&n.length>0){for(i="<div class='table-shadow' style='margin-bottom: 10px;'><table style='width:100%'><thead><tr><th>Date<\/th><th>Value<\/th><th>Units<\/th><th>Token <span title='Close' class='pull-right close-icon' style='cursor:pointer' onclick='$(\"#zetdc-tokeninfo-container a\").show(); $(\"#zetdc-tokeninfo-container .table-shadow\").remove();'><i class='fa fa-times'><\/i><\/span><\/th><\/thead><\/tr><tbody>",t=0;t<n.length;t++)i+="<tr><td>"+n[t].trn_TIMESTAMP+"<\/td><td>ZWL "+n[t].token_AMOUNT+"<\/td><td>"+n[t].token_UNITS+"<\/td><td>"+n[t].token+"<\/td><\/tr>";i+="<\/tbody><\/table><\/div>";ZETDC.tokenInfoContainer.append(i)}else ZETDC.tokenInfoContainer.append("<p>ZETDC did not list any purchase history for meter number "+ZETDC.meterNumber+"<\/p>")}).fail(function(){})},prepContainer:function(){ZETDC.container||($(".zssbpp-product-container").append($("<div class='form-group' id='zetdc-units-container'><label for='zetdc-units'>Units<\/label><div class='input-group'><div class='input-group-addon'>kWh<\/div><input class='form-control' type='number' step='0.01' id='zetdc-units' name='zetdc-units' value=''><\/div><small class='subtext'>How many units (kWh) do you want to purchase?<\/small><\/div>")),ZETDC.container=$("<div class='alert alert-info' style='display: none'><\/div>"),$(".zssbpp-product-container").append(ZETDC.container));ZETDC.tokenInfoContainer||(ZETDC.tokenInfoContainer=$("<div id='zetdc-tokeninfo-container' class='table-container' style='background-color:inherit; padding-top:0; padding-bottom:5px;'><a class='btn btn-tertiary' style='margin:0;' href='javascript:ZETDC.getPurchaseHistory()'>Show My Previously Purchased Tokens<\/a><\/div>"),$(".zssAccountDiv").after(ZETDC.tokenInfoContainer))}}